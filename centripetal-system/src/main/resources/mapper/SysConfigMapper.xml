<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.joyboys.system.mapper.SysConfigMapper">

  <delete id="deleteConfigById" parameterType="Long">
    delete
    from sys_config
    where config_id = #{configId}
  </delete>

  <delete id="deleteConfigByIds" parameterType="Long">
    delete from sys_config where config_id in
    <foreach close=")" collection="array" item="configId" open="(" separator=",">
      #{configId}
    </foreach>
  </delete>

  <!-- 查询条件 -->
  <insert id="insertConfig" parameterType="SysConfig">
    insert into sys_config (
    <if test="configName != null and configName != '' ">config_name,</if>
    <if test="configKey != null and configKey != '' ">config_key,</if>
    <if test="configValue != null and configValue != '' ">config_value,</if>
    <if test="configType != null and configType != '' ">config_type,</if>
    <if test="createBy != null and createBy != ''">create_by,</if>
    <if test="remark != null and remark != ''">remark,</if>
    create_time
    )values(
    <if test="configName != null and configName != ''">#{configName},</if>
    <if test="configKey != null and configKey != ''">#{configKey},</if>
    <if test="configValue != null and configValue != ''">#{configValue},</if>
    <if test="configType != null and configType != ''">#{configType},</if>
    <if test="createBy != null and createBy != ''">#{createBy},</if>
    <if test="remark != null and remark != ''">#{remark},</if>
    sysdate()
    )
  </insert>

  <resultMap id="SysConfigResult" type="SysConfig">
    <id column="config_id" property="configId"/>
    <result column="config_name" property="configName"/>
    <result column="config_key" property="configKey"/>
    <result column="config_value" property="configValue"/>
    <result column="config_type" property="configType"/>
    <result column="create_by" property="createBy"/>
    <result column="create_time" property="createTime"/>
    <result column="update_by" property="updateBy"/>
    <result column="update_time" property="updateTime"/>
  </resultMap>

  <select id="selectConfig" parameterType="SysConfig" resultMap="SysConfigResult">
    <include refid="selectConfigVo"/>
    <include refid="sqlwhereSearch"/>
  </select>

  <select id="selectConfigList" parameterType="SysConfig" resultMap="SysConfigResult">
    <include refid="selectConfigVo"/>
    <where>
      <if test="configName != null and configName != ''">
        AND config_name like concat('%', #{configName}, '%')
      </if>
      <if test="configType != null and configType != ''">
        AND config_type = #{configType}
      </if>
      <if test="configKey != null and configKey != ''">
        AND config_key like concat('%', #{configKey}, '%')
      </if>
      <if test="params.beginTime != null and params.beginTime != ''"><!-- 开始时间检索 -->
        and date_format(create_time,'%y%m%d') &gt;= date_format(#{params.beginTime},'%y%m%d')
      </if>
      <if test="params.endTime != null and params.endTime != ''"><!-- 结束时间检索 -->
        and date_format(create_time,'%y%m%d') &lt;= date_format(#{params.endTime},'%y%m%d')
      </if>
    </where>
  </select>

  <select id="selectConfigById" parameterType="Long" resultMap="SysConfigResult">
    <include refid="selectConfigVo"/>
    where config_id = #{configId}
  </select>

  <select id="checkConfigKeyUnique" parameterType="String" resultMap="SysConfigResult">
    <include refid="selectConfigVo"/>
    where config_key = #{configKey} limit 1
  </select>

  <sql id="selectConfigVo">
    select config_id,
           config_name,
           config_key,
           config_value,
           config_type,
           create_by,
           create_time,
           update_by,
           update_time,
           remark
    from sys_config
  </sql>

  <sql id="sqlwhereSearch">
    <where>
      <if test="configId !=null">
        and config_id = #{configId}
      </if>
      <if test="configKey !=null and configKey != ''">
        and config_key = #{configKey}
      </if>
    </where>
  </sql>

  <update id="updateConfig" parameterType="SysConfig">
    update sys_config
    <set>
      <if test="configName != null and configName != ''">config_name = #{configName},</if>
      <if test="configKey != null and configKey != ''">config_key = #{configKey},</if>
      <if test="configValue != null and configValue != ''">config_value = #{configValue},</if>
      <if test="configType != null and configType != ''">config_type = #{configType},</if>
      <if test="updateBy != null and updateBy != ''">update_by = #{updateBy},</if>
      <if test="remark != null">remark = #{remark},</if>
      update_time = sysdate()
    </set>
    where config_id = #{configId}
  </update>

</mapper>